<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Tragaperras 3x3 Casino</title>
<style>
body {
    background: black;
    color: lime;
    font-family: monospace;
    text-align: center;
}
button, input {
    font-size: 18px;
    padding: 8px;
    margin: 6px;
}
.reels {
    font-size: 22px;
    line-height: 22px;
    margin: 20px auto;
    white-space: pre;
}
</style>
</head>
<body>

<h1>ğŸ° TRAGAPERRAS 3x3 CASINO ğŸ°</h1>

<p>Dinero: $<span id="money">100</span></p>
<p>Jackpot: $<span id="jackpot">1000</span></p>
<p>Multiplicador: x<span id="mult">1</span></p>

<input type="number" id="bet" placeholder="CuÃ¡nto apostar" min="1">
<br>

<button onclick="spin()">ğŸ² TIRAR</button>
<button onclick="buyMult()">Comprar x2 Mult ($100)</button>
<button onclick="resetGame()">ğŸ”„ Reiniciar</button>

<div class="reels" id="reels">
+-----------------------+
|  ğŸ’   ğŸ’   ğŸ’  |
|  ğŸ‹   ğŸ””   ğŸ’  |
|  â­   ğŸ’°   ğŸ’  |
+-----------------------+
</div>

<p id="log">Esperando tu jugadaâ€¦</p>

<!-- Sonidos -->
<audio id="spinSound" src="https://actions.google.com/sounds/v1/foley/slot_machine_spin.ogg"></audio>
<audio id="winLineSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="jackpotSound" src="https://actions.google.com/sounds/v1/cartoon/large_prize.ogg"></audio>
<audio id="loseSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script>
let money = 100;
let mult = 1;
let jackpot = 1000;
const jackpotStart = 1000;

const symbols = [
    {icon: "ğŸ’", value: 1, weight: 50},
    {icon: "ğŸ‹", value: 2, weight: 25},
    {icon: "ğŸ””", value: 5, weight: 12},
    {icon: "ğŸ’", value: 10, weight: 7},
    {icon: "â­", value: 20, weight: 4},
    {icon: "ğŸ’°", value: 0, weight: 2}
];

function weightedRandom() {
    let total = symbols.reduce((sum, s) => sum + s.weight, 0);
    let roll = Math.random() * total;
    for (let s of symbols) {
        if (roll < s.weight) return s;
        roll -= s.weight;
    }
}

function getRandomGrid() {
    return [
        [weightedRandom(), weightedRandom(), weightedRandom()],
        [weightedRandom(), weightedRandom(), weightedRandom()],
        [weightedRandom(), weightedRandom(), weightedRandom()]
    ];
}

function renderGrid(grid) {
    return `+-----------------------+
|  ${grid[0][0].icon}   ${grid[0][1].icon}   ${grid[0][2].icon}  |
|  ${grid[1][0].icon}   ${grid[1][1].icon}   ${grid[1][2].icon}  |
|  ${grid[2][0].icon}   ${grid[2][1].icon}   ${grid[2][2].icon}  |
+-----------------------+`;
}

function spin() {
    const betInput = document.getElementById("bet");
    const bet = Number(betInput.value);

    if (!betInput.value || bet <= 0) {
        log("âŒ TenÃ©s que escribir cuÃ¡nto apostar");
        return;
    }
    if (bet > money) {
        log("âŒ No tenÃ©s suficiente dinero");
        return;
    }

    document.getElementById("spinSound").play();

    // animaciÃ³n de giro
    let animationCount = 0;
    const animationInterval = setInterval(() => {
        const tempGrid = getRandomGrid();
        document.getElementById("reels").innerText = renderGrid(tempGrid);
        animationCount++;

        if (animationCount >= 12) {
            clearInterval(animationInterval);
            finalSpin(bet);
        }
    }, 80);
}

function finalSpin(bet) {
    const grid = getRandomGrid();
    document.getElementById("reels").innerText = renderGrid(grid);

    const lines = [
        [grid[0][0], grid[0][1], grid[0][2]],
        [grid[1][0], grid[1][1], grid[1][2]],
        [grid[2][0], grid[2][1], grid[2][2]],
        [grid[0][0], grid[1][1], grid[2][2]],
        [grid[0][2], grid[1][1], grid[2][0]]
    ];

    let win = 0;
    let winLines = 0;

    for (let line of lines) {
        if (line[0].icon === line[1].icon && line[1].icon === line[2].icon) {
            winLines++;
            if (line[0].icon === "ğŸ’°") {
                win += jackpot;
                jackpot = jackpotStart;
            } else {
                win += bet * line[0].value * mult;
            }
        }
    }

    if (winLines === 0) {
        money -= bet;
        jackpot += bet;
        document.getElementById("loseSound").play();
        log("âŒ Perdiste $" + bet);
    } else {
        money += win;
        document.getElementById("winLineSound").play();
        if (win >= jackpotStart) {
            document.getElementById("jackpotSound").play();
        }
        log("ğŸ’° Ganaste $" + win + " en " + winLines + " lÃ­nea(s)");
    }

    updateUI();
}

function buyMult() {
    if (money < 100) {
        log("âŒ No tenÃ©s suficiente dinero");
        return;
    }
    money -= 100;
    mult *= 2;
    log("âœ–ï¸ Multiplicador mejorado a x" + mult);
    updateUI();
}

function resetGame() {
    money = 100;
    mult = 1;
    jackpot = jackpotStart;
    log("ğŸ”„ Juego reiniciado");
    updateUI();
}

function updateUI() {
    document.getElementById("money").innerText = money;
    document.getElementById("jackpot").innerText = jackpot;
    document.getElementById("mult").innerText = mult;
}

function log(text) {
    document.getElementById("log").innerText = text;
}
</script>

</body>
</html>

